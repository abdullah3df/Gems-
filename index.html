<!DOCTYPE html><html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>لعبة شبيهة بالشطرنج – نموذج أولي (AI + ألوان كاملة)</title>
  <style>
    :root{
      --light:#f0d9b5; --dark:#b58863; --board-size:min(88vmin, 720px);
      --ok:#00bfa5; --warn:#f44336; --hint:#90caf9;
      --green:#1f7a34; --red:#8b1b1b;
    }
    *{box-sizing:border-box}
    body{margin:0; padding:18px; background:#0f141a; color:#e6edf3;
         font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Noto Sans",Tahoma,Arial,sans-serif;
         display:grid; place-items:center}
    .wrap{display:grid; gap:12px; width:min(1200px,96vw)}.hud{display:flex; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap}
.tag{background:#151b22; border:1px solid rgba(255,255,255,.08); padding:8px 12px; border-radius:999px; font-size:13px}

.board{width:var(--board-size); height:var(--board-size); display:grid; grid-template-columns:repeat(8,1fr); grid-template-rows:repeat(8,1fr);
       border:10px solid #2a343f; border-radius:16px; overflow:hidden;
       box-shadow:0 10px 30px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.05);
       margin:0 auto; position:relative}
.sq{position:relative; width:100%; height:100%;}
.light{background:var(--light)} .dark{background:var(--dark)}

/* مربعات خاصة – لون كامل بدون أسماء */
.center4{outline: none}
.center-green{background: var(--green) !important}
.center-red{background: var(--red) !important}

/* تمييز التحديد والمسارات */
.sel{box-shadow: inset 0 0 0 4px var(--hint)}
.move{outline:3px solid var(--ok); outline-offset:-3px}
.capture{outline:3px solid var(--warn); outline-offset:-3px}

/* قطع (رموز) */
.piece{position:absolute; inset:0; display:grid; place-items:center; font-size:clamp(18px,5.2vmin,30px); font-weight:700; color:#0b1416;
       text-shadow:0 1px 0 rgba(255,255,255,.25)}
.badge{position:absolute; right:6px; bottom:6px; font-size:11px; background:#151b22; color:#e6edf3; border:1px solid rgba(255,255,255,.12); border-radius:6px; padding:2px 6px}
.badge.ok{background:#0b3b36; border-color:#0d7f71}
.badge.freeze{background:#3a0b0b; border-color:#a93333}

.note{justify-self:center; font-size:12px; opacity:.85}
.controls{display:flex; gap:8px; justify-content:center; flex-wrap:wrap}
button{background:#1f2a33; color:#e6edf3; border:1px solid rgba(255,255,255,.12); border-radius:10px; padding:8px 12px; cursor:pointer}
button.primary{background:#0d7f71; border-color:transparent}

  </style>
</head>
<body>
  <div class="wrap">
    <div class="hud">
      <span class="tag">الدور: <b id="turn">الأبيض</b></span>
      <span class="tag">الأخضر: الجندي يحصل على حركة وزير لنقلة واحدة (في دوره القادم فقط)</span>
      <span class="tag">الأحمر: أي قطعة تصبح جندي، والجندي يتجمّد دورًا واحدًا</span>
      <span class="tag">الذكاء الاصطناعي: <b>الأسود</b></span>
    </div><div id="board" class="board" aria-label="لوحة 8×8"></div>

<div class="controls">
  <button id="reset" class="primary">إعادة ضبط</button>
  <button id="toggleHelp">إظهار/إخفاء الملاحظات</button>
</div>
<div id="help" class="note">نموذج تجريبي: لا يوجد فحص كش/مات أو قلعة/أخذ بالتجاوز. القواعد الخاصة تعمل، والكمبيوتر (الأسود) يلعب تلقائيًا بعد نقلة اللاعب.</div>

  </div>  <script>
    // ======= إعداد اللوحة =======
    const boardEl = document.getElementById('board');
    const files = ['a','b','c','d','e','f','g','h'];
    const ranks = [8,7,6,5,4,3,2,1];

    function algebraic(f,r){ return files[f] + ranks[r]; }
    function parseSquare(name){ return {f: files.indexOf(name[0]), r: ranks.indexOf(Number(name[1]))}; }
    function inside(f,r){ return f>=0&&f<8&&r>=0&&r<8; }

    const greenSquares = new Set(['e4','d5']);
    const redSquares   = new Set(['d4','e5']);
    const center4 = new Set([...greenSquares, ...redSquares]);

    // إنشاء خلايا
    for (let r = 0; r < 8; r++) {
      for (let f = 0; f < 8; f++) {
        const isDark = (r + f) % 2 === 1;
        const sq = document.createElement('div');
        sq.className = `sq ${isDark ? 'dark' : 'light'}`;
        const name = algebraic(f,r);
        sq.dataset.square = name;
        if (center4.has(name)) sq.classList.add('center4');
        if (greenSquares.has(name)) sq.classList.add('center-green');
        if (redSquares.has(name))   sq.classList.add('center-red');
        boardEl.appendChild(sq);
      }
    }

    // ======= حالة اللعبة =======
    let pieces = [];
    let turnWhite = true; // اللاعب بشري: الأبيض
    let turnNumber = 1;

    function newGame(){
      pieces = [];
      for(let f=0; f<8; f++){ pieces.push({type:'p', white:true,  f, r:6, boostTurn:null, skipped:false}); }
      for(let f=0; f<8; f++){ pieces.push({type:'p', white:false, f, r:1, boostTurn:null, skipped:false}); }
      const back=['r','n','b','q','k','b','n','r'];
      for(let f=0; f<8; f++){ pieces.push({type:back[f], white:true,  f, r:7, boostTurn:null, skipped:false}); }
      for(let f=0; f<8; f++){ pieces.push({type:back[f], white:false, f, r:0, boostTurn:null, skipped:false}); }
      turnWhite = true; turnNumber = 1; selected = null; render();
    }

    function at(f,r){ return pieces.find(p=>p.f===f && p.r===r); }
    function squareFree(f,r){ return !at(f,r); }

    function glyph(p){
      const W={p:'♙', r:'♖', n:'♘', b:'♗', q:'♕', k:'♔'};
      const B={p:'♟', r:'♜', n:'♞', b:'♝', q:'♛', k:'♚'};
      return p.white ? W[p.type] : B[p.type];
    }

    function render(){
      document.querySelectorAll('.piece').forEach(n=>n.remove());
      document.querySelectorAll('.sq').forEach(sq=>sq.classList.remove('sel','move','capture'));
      document.getElementById('turn').textContent = turnWhite ? 'الأبيض' : 'الأسود';
      for(const p of pieces){
        const holder = document.querySelector(`.sq[data-square="${algebraic(p.f,p.r)}"]`);
        if(!holder) continue;
        const el = document.createElement('div'); el.className='piece'; el.textContent=glyph(p);
        if(p.type==='p' && p.boostTurn!==null){ const b=document.createElement('div'); b.className='badge ok'; b.textContent='Boost'; el.appendChild(b); }
        if(p.type==='p' && p.skipped){ const b=document.createElement('div'); b.className='badge freeze'; b.textContent='Freeze'; el.appendChild(b); }
        holder.appendChild(el);
      }
    }

    // ======= توليد النقلات =======
    function rays(p, dirs, limit=8){
      const ms=[];
      for(const [df,dr] of dirs){
        for(let s=1;s<=limit;s++){
          const nf=p.f+df*s, nr=p.r+dr*s; if(!inside(nf,nr)) break;
          const occ=at(nf,nr);
          if(occ){ if(occ.white!==p.white) ms.push({f:nf,r:nr,capture:true}); break; }
          else ms.push({f:nf,r:nr});
        }
      }
      return ms;
    }

    function legalMoves(p){
      if(p.type==='p' && p.skipped && p.white===turnWhite) return [];
      if(p.type==='p' && p.boostTurn===turnNumber && p.white===turnWhite){
        const ms = rays(p, [[1,0],[-1,0],[0,1],[0,-1],[1,1],[1,-1],[-1,1],[-1,-1]]);
        return ms.map(m=>({...m, tag:'boost'}));
      }
      switch(p.type){
        case 'p':{
          const dir = p.white ? -1 : 1;
          const startRank = p.white ? 6 : 1;
          const ms=[];
          if(inside(p.f,p.r+dir) && squareFree(p.f,p.r+dir)) ms.push({f:p.f,r:p.r+dir});
          if(p.r===startRank && squareFree(p.f,p.r+dir) && squareFree(p.f,p.r+2*dir)) ms.push({f:p.f,r:p.r+2*dir});
          for(const df of [-1,1]){
            const nf=p.f+df, nr=p.r+dir; if(!inside(nf,nr)) continue; const occ=at(nf,nr);
            if(occ && occ.white!==p.white) ms.push({f:nf,r:nr,capture:true});
          }
          return ms;
        }
        case 'r': return rays(p, [[1,0],[-1,0],[0,1],[0,-1]]);
        case 'b': return rays(p, [[1,1],[1,-1],[-1,1],[-1,-1]]);
        case 'q': return rays(p, [[1,0],[-1,0],[0,1],[0,-1],[1,1],[1,-1],[-1,1],[-1,-1]]);
        case 'n':{
          const jumps=[[1,2],[2,1],[-1,2],[-2,1],[1,-2],[2,-1],[-1,-2],[-2,-1]]; const ms=[];
          for(const [df,dr] of jumps){ const nf=p.f+df, nr=p.r+dr; if(!inside(nf,nr)) continue; const occ=at(nf,nr); if(occ){ if(occ.white!==p.white) ms.push({f:nf,r:nr,capture:true}); } else ms.push({f:nf,r:nr}); }
          return ms;
        }
        case 'k': return rays(p, [[1,0],[-1,0],[0,1],[0,-1],[1,1],[1,-1],[-1,1],[-1,-1]], 1);
      }
      return [];
    }

    // ======= تفاعل =======
    let selected = null;

    function highlight(moves){
      document.querySelectorAll('.sq').forEach(sq=>sq.classList.remove('sel','move','capture'));
      if(!selected) return;
      document.querySelector(`.sq[data-square="${algebraic(selected.f,selected.r)}"]`).classList.add('sel');
      for(const m of moves){
        const t = document.querySelector(`.sq[data-square="${algebraic(m.f,m.r)}"]`);
        t.classList.add(m.capture? 'capture':'move');
      }
    }

    function isGreen(name){ return greenSquares.has(name); }
    function isRed(name){ return redSquares.has(name); }

    function endTurnCleanup(){
      for(const p of pieces){
        if(p.type==='p' && p.boostTurn===turnNumber && p.white===turnWhite){ p.boostTurn = null; }
      }
      for(const p of pieces){ if(p.type==='p' && p.white===turnWhite && p.skipped) p.skipped=false; }
    }

    function movePiece(p, targetF, targetR, tag){
      const victim = at(targetF,targetR);
      if(victim){ pieces.splice(pieces.indexOf(victim),1); }
      p.f = targetF; p.r = targetR;
      const targetName = algebraic(targetF,targetR);
      if(isGreen(targetName) && p.type==='p'){ p.boostTurn = turnNumber + 2; }
      if(isRed(targetName)){
        if(p.type==='p'){ p.skipped = true; }
        else{ p.type='p'; p.boostTurn=null; p.skipped=false; if(p.r===0||p.r===7) p.type='q'; }
      }
      if(tag==='boost' && p.type==='p'){ p.boostTurn=null; }
      endTurnCleanup();
      turnWhite = !turnWhite; turnNumber++;
      selected = null; render();
      // دور الكمبيوتر إن أصبح الأسود
      if(!turnWhite){ setTimeout(aiMove, 200); }
    }

    function onSquareClick(name){
      if(!turnWhite) return; // انتظار الكمبيوتر
      const {f,r} = parseSquare(name);
      const here = at(f,r);
      if(selected){
        const moves = legalMoves(selected);
        const ok = moves.find(m=>m.f===f && m.r===r);
        if(ok){ movePiece(selected, f, r, ok.tag); return; }
      }
      if(here && here.white===turnWhite){ selected = here; highlight(legalMoves(here)); }
      else { selected = null; highlight([]); }
    }

    boardEl.querySelectorAll('.sq').forEach(sq=>{
      sq.addEventListener('click', ()=> onSquareClick(sq.dataset.square));
    });

    // ======= ذكاء اصطناعي بسيط (الأسود) =======
    function allMovesFor(white){
      const all=[];
      for(const p of pieces){
        if(p.white!==white) continue;
        // احترام التجميد/البوست بنفس منطق legalMoves
        const currentTurnWhite = white; const savedTurn = turnWhite; const savedNumber = turnNumber;
        // نحتاج legalMoves كما لو كان دوره
        const wasTurn = turnWhite; turnWhite = white; // hack بسيط
        const ms = legalMoves(p).map(m=>({p, ...m}));
        turnWhite = wasTurn;
        all.push(...ms);
      }
      return all;
    }

    function valueOfType(t){ return ({p:1,n:3,b:3,r:5,q:9,k:1000})[t]||0; }

    function aiMove(){
      // تجميع كل النقلات للأسود
      const moves = allMovesFor(false);
      if(moves.length===0){ turnWhite=true; render(); return; }
      // سياسة بسيطة: 1) أولوية للأسر الأعلى قيمة  2) تفضيل الوصول للأخضر بالجندي  3) وإلا عشوائي
      let best = null; let bestScore = -1e9;
      for(const m of moves){
        let score = Math.random()*0.01; // كسر تعادل بسيط
        const victim = at(m.f,m.r); if(victim) score += valueOfType(victim.type)*10;
        if(m.tag==='boost') score += 1; // استخدام Boost جيد لكن ليس أولوية على الأسر
        const name = algebraic(m.f,m.r);
        const movingPawn = (m.p.type==='p');
        if(movingPawn && isGreen(name)) score += 2; // الوصول للأخضر مفيد
        if(isRed(name) && movingPawn) score -= 0.5; // الأحمر يجمّد الجندي
        if(isRed(name) && !movingPawn) score -= 0.2; // التحول لجندي غالبًا أسوأ
        if(score>bestScore){ bestScore=score; best=m; }
      }
      if(best){ movePiece(best.p, best.f, best.r, best.tag); }
    }

    document.getElementById('reset').addEventListener('click', newGame);
    document.getElementById('toggleHelp').addEventListener('click', ()=>{
      const el=document.getElementById('help'); el.style.display = (el.style.display==='none')? 'block':'none';
    });

    newGame();
  </script></body>
</html>
